Option Explicit

Sub StackAllSheets_AsPictures()
    Dim ws As Worksheet, wsOut As Worksheet
    Dim lastRow As Long, lastCol As Long, destRow As Long
    Dim rngFound As Range, rngBlock As Range
    Dim pic As Shape
    Dim outName As String
    
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    
    outName = "StackPics_" & Format(Now, "yyyymmdd_hhmmss")
    Set wsOut = ThisWorkbook.Worksheets.Add(After:=Worksheets(Worksheets.Count))
    wsOut.Name = outName
    
    destRow = 1
    
    For Each ws In ThisWorkbook.Worksheets
        If ws.Name <> wsOut.Name Then
            
            Set rngFound = Nothing
            On Error Resume Next
            Set rngFound = ws.Cells.Find(What:="*", LookIn:=xlFormulas, _
                                         SearchOrder:=xlByRows, SearchDirection:=xlPrevious)
            On Error GoTo 0
            
            If Not rngFound Is Nothing Then
                lastRow = rngFound.Row
                lastCol = ws.Cells.Find(What:="*", LookIn:=xlFormulas, _
                                        SearchOrder:=xlByColumns, SearchDirection:=xlPrevious).Column
                Set rngBlock = ws.Range(ws.Cells(1, 1), ws.Cells(lastRow, lastCol))
                
                ' Titre
                With wsOut.Cells(destRow, 1)
                    .Value = ws.Name
                    .Font.Bold = True
                End With
                destRow = destRow + 1
                
                ' Copier en image (fidélité visuelle)
                rngBlock.CopyPicture Appearance:=xlScreen, Format:=xlPicture
                wsOut.Paste wsOut.Cells(destRow, 1)
                
                Set pic = wsOut.Shapes(wsOut.Shapes.Count)
                ' Positionner précisément
                pic.Top = wsOut.Cells(destRow, 1).Top
                pic.Left = wsOut.Cells(destRow, 1).Left
                
                ' Avancer destRow sous l'image (en fonction de sa hauteur en points)
                Dim hPts As Double, rowH As Double, rowsNeeded As Long
                hPts = pic.Height
                rowH = wsOut.Rows(destRow).RowHeight
                If rowH = 0 Then rowH = 15
                rowsNeeded = Application.WorksheetFunction.RoundUp(hPts / rowH, 0) + 2
                destRow = destRow + rowsNeeded
            End If
        End If
    Next ws
    
    wsOut.Activate
    wsOut.Cells(1, 1).Select
    
    Application.ScreenUpdating = True
    Application.EnableEvents = True
    
    MsgBox "Empilement (images) terminé dans '" & wsOut.Name & "'.", vbInformation
End Sub