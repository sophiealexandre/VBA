Option Explicit

Sub StackAllSheets_AllContent()
    Dim ws As Worksheet, wsOut As Worksheet
    Dim lastRow As Long, lastCol As Long, destRow As Long
    Dim rng As Range
    
    Application.ScreenUpdating = False
    
    ' Crée la feuille de sortie
    Set wsOut = ThisWorkbook.Worksheets.Add(After:=Worksheets(Worksheets.Count))
    wsOut.Name = "StackResult"
    
    destRow = 1
    
    ' Boucle sur toutes les feuilles
    For Each ws In ThisWorkbook.Worksheets
        If ws.Name <> wsOut.Name Then
            
            ' Détermine la zone utilisée
            On Error Resume Next
            lastRow = ws.Cells.Find("*", , , , xlByRows, xlPrevious).Row
            lastCol = ws.Cells.Find("*", , , , xlByColumns, xlPrevious).Column
            On Error GoTo 0
            
            If lastRow > 0 And lastCol > 0 Then
                Set rng = ws.Range(ws.Cells(1, 1), ws.Cells(lastRow, lastCol))
                
                ' Ligne séparatrice = nom de la feuille
                wsOut.Cells(destRow, 1).Value = ws.Name
                wsOut.Cells(destRow, 1).Font.Bold = True
                destRow = destRow + 1
                
                ' Copie TOUT (valeurs + formats + bordures + fusions…)
                rng.Copy
                wsOut.Cells(destRow, 1).PasteSpecial Paste:=xlPasteAll
                Application.CutCopyMode = False
                
                ' Décale le point d’insertion sous le bloc copié
                destRow = wsOut.Cells(wsOut.Rows.Count, 1).End(xlUp).Row + 2
            End If
        End If
    Next ws
    
    wsOut.Columns.AutoFit
    wsOut.Activate
    
    Application.ScreenUpdating = True
    
    MsgBox "Toutes les feuilles ont été empilées dans '" & wsOut.Name & "'.", vbInformation
End Sub