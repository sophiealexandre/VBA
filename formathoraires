Sub ExtraireTousBlocsVoyage()
    Dim ws As Worksheet, newWs As Worksheet
    Dim i As Long, rowNum As Long, lastRow As Long
    Dim startRow As Long, endRow As Long
    Dim inBloc As Boolean
    Dim sheetCount As Integer
    Dim cell As Range
    
    Application.ScreenUpdating = False
    sheetCount = 1

    For Each ws In ThisWorkbook.Worksheets
        lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row
        startRow = 0
        inBloc = False

        For rowNum = 1 To lastRow
            Set cell = Nothing
            On Error Resume Next
            Set cell = ws.Rows(rowNum).Find(What:="voyage", LookIn:=xlValues, LookAt:=xlPart, _
                                            SearchOrder:=xlByColumns, MatchCase:=False)
            On Error GoTo 0

            If Not cell Is Nothing Then
                If inBloc Then
                    endRow = rowNum - 1
                    Call CopierBloc(ws, startRow, endRow, sheetCount)
                    sheetCount = sheetCount + 1
                End If
                startRow = rowNum
                inBloc = True
            End If
        Next rowNum

        If inBloc Then
            endRow = lastRow
            Call CopierBloc(ws, startRow, endRow, sheetCount)
            sheetCount = sheetCount + 1
        End If
    Next ws

    Application.ScreenUpdating = True
    MsgBox (sheetCount - 1) & " onglet(s) créés pour les blocs contenant 'voyage'.", vbInformation
End Sub

Sub CopierBloc(sourceWs As Worksheet, startRow As Long, endRow As Long, index As Integer)
    Dim newWs As Worksheet
    Dim newSheetName As String
    Dim rngToCopy As Range
    Dim lastCol As Long
    Dim r As Long, c As Long
    Dim voyageCol As Long
    Dim currentCell As Range
    
    newSheetName = "Voyage"
    If index > 1 Then newSheetName = newSheetName & " (" & index & ")"
    Do While SheetExists(newSheetName)
        index = index + 1
        newSheetName = "Voyage (" & index & ")"
    Loop

    Set newWs = Worksheets.Add(After:=Worksheets(Worksheets.Count))
    newWs.Name = newSheetName

    Set rngToCopy = sourceWs.Rows(startRow & ":" & endRow)
    rngToCopy.Copy Destination:=newWs.Range("A1")

    ' Trouver la colonne "voyage"
    voyageCol = 0
    For Each currentCell In newWs.Rows(1).Cells
        If LCase(currentCell.Value) Like "*voyage*" Then
            voyageCol = currentCell.Column
            Exit For
        End If
    Next currentCell

    If voyageCol = 0 Then Exit Sub ' sécurité

    lastCol = newWs.Cells(1, newWs.Columns.Count).End(xlToLeft).Column

    ' Vider les colonnes à gauche de "voyage"
    For r = 1 To endRow - startRow + 1
        For c = 1 To voyageCol - 1
            newWs.Cells(r, c).Value = ""
        Next c
    Next r

    ' Mise en forme
    With newWs.Rows(1)
        .Font.Bold = True
        .Interior.Color = RGB(180, 210, 255) ' bleu moyen
    End With

    For r = 2 To endRow - startRow + 1
        If r Mod 2 = 0 Then
            newWs.Rows(r).Interior.Color = RGB(230, 230, 230) ' gris clair
        Else
            newWs.Rows(r).Interior.ColorIndex = xlNone ' blanc
        End If
    Next r

    newWs.Columns.AutoFit
End Sub

Function SheetExists(sheetName As String) As Boolean
    On Error Resume Next
    SheetExists = Not Worksheets(sheetName) Is Nothing
    On Error GoTo 0
End Function